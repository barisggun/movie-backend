@model MovieDetailModel

<form id="addCommentForm" method="post" asp-action="AddComment" asp-controller="Comment">
    <div asp-validation-summary="All" style="background-color:white;color:red;"></div>
    <div class="review-input">
        <input name="MovieId" type="hidden" value="@Model.MovieId" />
        <input name="CommentContent" type="text" placeholder="Yorumunuz" />
        <button id="addCommentButton" class="addComment" type="submit">Yorum ekle</button>
    </div>
    <div id="errorContainer" style="background-color:white;color:red;"></div> 
</form>


<script src="https://code.jquery.com/jquery-3.5.1.min.js" type="text/javascript"></script>
<script>
    $(document).ready(function () {
        $("#addCommentForm").submit(function (event) {
            event.preventDefault();

            if (!isUserAuthenticated()) {
                // Kullanıcı giriş yapmamışsa uygun bir mesaj göster ve "/Account/Login" sayfasına yönlendir
                alert("Yorum yapmak için giriş yapmalısınız!");
                window.location.href = "/Account/Login";
                return;
            }

            var formData = $(this).serialize();

            $.ajax({
                url: $(this).attr("action"),
                type: $(this).attr("method"),
                data: formData,
                success: function (response) {
                    var newCommentHtml = $(response).find("#commentContainer").html();
                    $("#commentComponentContainer").html(newCommentHtml);
                    $("#addCommentForm")[0].reset();
                    $("#errorContainer").empty(); // Hata mesajını temizle
                },
                error: function (xhr, status, error) {
                    console.error(error);
                    $("#errorContainer").text("Çok hızlı yorum ekliyorsunuz. Lütfen 10 saniye bekleyin."); // Hata mesajını güncelle
                }
            });
        });

        function isUserAuthenticated() {
            // Kullanıcı giriş yapmışsa true, yapmamışsa false döndür
            return @User.Identity.IsAuthenticated.ToString().ToLower();
        }
    });
</script>
